<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>

<title>rb-aem manual | 6. Building and sending events</title>

<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<style type="text/css" media="all"><!--@import url(../full.css);--></style>

</head>
<body>

<h1><img src="../rb-appscript-logo.png" alt="rb-appscript" title="rb-appscript" /></h1>

<!-- top navigation -->
<div class="navbar">
<a href="05_targetingapplications.html">Previous</a> &bull;
<a href="index.html">Up</a> &bull;
<a href="07_findapp.html">Next</a>

<span>
<a href="../appscript-manual/index.html">appscript</a> /
<a href="../mactypes-manual/index.html">mactypes</a> /
<a href="../osax-manual/index.html">osax</a> /
<strong><a href="../aem-manual/index.html">aem</a></strong>
</span>
</div>

<!-- content -->
<div id="content">

<h2>6. Building and sending events</h2>


<h3>The <code>Application#event</code> method</h3>

<p>The <code>Application#event</code> method is used to create new Apple events targetted at the specified application.</p>

<pre><code>Application -- the target application
        ...

        event(event_code, params={}, atts={}, return_id=KAE::KAutoGenerateReturnID,
                codecs=DefaultCodecs) -- construct an Apple event
            event_code : string -- 8-letter code indicating event's class and id,
                    e.g. 'coregetd'
            params : hash -- a hash of form {AE_code=&gt;anything,...} containing
                    zero or more event parameters
            atts : hash -- a hash of form {AE_code=&gt;anything,...} containing
                    zero or more event attributes
            return_id : integer  -- reply event's ID
            codecs : Codecs -- codecs object to use when packing/unpacking
                    attributes and parameters for this event and its reply
            Result : Event -- a ready-to-send Apple event</code></pre>



<h3>The <code>Event</code> class</h3>

<p>The <code>Event</code> class represents an Apple event that has been packed and is ready to send.</p>

<pre><code>Event

    Methods:

        send(timeout=KAE::KDefaultTimeout, flags=KAE::KAEWaitReply) -- send event
            timeout : integer | KAE::KDefaultTimeout | KAE::KNoTimeOut -- number of
                    ticks to wait for application reply before raising timeout error
            flags : integer -- bitwise flags determining how event should be
                    handled
            Result : anything -- value returned by application, if any</code></pre>


<p>The <code>send</code> method may be called any number of times.</p>


<h3>Constants</h3>

<p>The following constants are defined in the <code>KAE</code> module.</p>

<h4>Common parameter keys</h4>

<pre><code>KAE::KeyDirectObject
KAE::KeyAERequestedType</code></pre>

<p>(The value for a <code>keyAERequestedType</code> parameter should be an <code>AEType</code> instance.)</p>

<p>Other parameter keys are defined by individual applications.</p>


<h4>Attribute keys</h4>

<p>Most of the following attributes are already supplied by other means (e.g. keyEventClassAttr, keyEventIDAttr are supplied separately when creating an Apple event; keyTimeoutAttr when sending it) and are only of interest if unpacking AppleEvent descriptors manually. A few  may be used when passing an attributes dict to <code>Application#event</code> (<code>EnumConsiderations</code>, <code>EnumConsidsAndIgnores</code>, <code>KeySubjectAttr</code>):</p>

<pre><code>KAE::KeyTransactionIDAttr
KAE::KeyReturnIDAttr
KAE::KeyEventClassAttr
KAE::KeyEventIDAttr
KAE::KeyAddressAttr
KAE::KeyOptionalKeywordAttr
KAE::KeyTimeoutAttr
KAE::KeyInteractLevelAttr
KAE::KeyEventSourceAttr
KAE::KeyOriginalAddressAttr
KAE::KeyAcceptTimeoutAttr
KAE::EnumConsiderations
KAE::EnumConsidsAndIgnores
KAE::KeySubjectAttr</code></pre>


<p>The value of the <code>EnumConsiderations</code> attribute should be a list containing zero or more <code>AEEnum</code> instances with the following codes:</p> 

<pre><code>KAE::KAECase
KAE::KAEDiacritic
KAE::KAEWhiteSpace
KAE::KAEHyphens
KAE::KAEExpansion
KAE::KAEPunctuation
KAE::KASConsiderReplies
KAE::KASNumericStrings</code></pre>

<p>See the <a href="http://developer.apple.com/documentation/Carbon/Reference/Apple_Event_Manager/index.html">Apple Event Manager</a> API reference for more info. Note that the <code>EnumConsiderations</code> attribute is deprecated in favour of the <code>EnumConsidsAndIgnores</code> attribute.</p>


<p>The value of the <code>EnumConsidsAndIgnores</code> attribute should be an integer composed from the sum of zero or more of the following bit masks:</p>

<pre><code>KAE::KAECaseConsiderMask
KAE::KAEDiacriticConsiderMask
KAE::KAEWhiteSpaceConsiderMask
KAE::KAEHyphensConsiderMask
KAE::KAEExpansionConsiderMask
KAE::KAEPunctuationConsiderMask
KAE::KASConsiderRepliesConsiderMask
KAE::KASNumericStringsConsiderMask

KAE::KAECaseIgnoreMask
KAE::KAEDiacriticIgnoreMask
KAE::KAEWhiteSpaceIgnoreMask
KAE::KAEHyphensIgnoreMask
KAE::KAEExpansionIgnoreMask
KAE::KAEPunctuationIgnoreMask
KAE::KASConsiderRepliesIgnoreMask
KAE::KASNumericStringsIgnoreMask</code></pre>


<h4>Send flag constants</h4>

<p>The value of the <code>send</code> method's <code>flags</code> argument should be an integer composed from the sum of zero or more of the following bit masks:</p>

<pre><code>KAE::KAENoReply
KAE::KAEQueueReply
KAE::KAEWaitReply

KAE::KAEDontReconnect

KAE::KAEWantReceipt

KAE::KAENeverInteract
KAE::KAECanInteract
KAE::KAEAlwaysInteract

KAE::KAECanSwitchLayer</code></pre>

<p>See the <a href="http://developer.apple.com/documentation/Carbon/Reference/Apple_Event_Manager/apple_event_manager_ref/chapter_1.4_section_6.html">Apple Event Manager</a> API reference for details.</p>


<h4>Other constants</h4>

<pre><code>KAE::KAutoGenerateReturnID</code></pre>


<h3>Exception classes</h3>

<h4>The <code>EventError</code> class</h4>

<p>The <code>EventError</code> class is raised by <code>Event#send</code> and represents an error raised by the target application or Apple Event Manager when sending an event.</p>

<pre><code>EventError &lt; RuntimeError

    Methods:
        
        number
            Result: integer -- Mac OS error number

        message
            Result: string | nil -- application-supplied/generic 
                    error description
        
        offending_object
            Result: anything | nil -- object that caused the error, 
                    if given by application
        
        expected_type
            Result: anything | nil -- object that caused a coercion 
                    error, if given by application
        
        partial_result
            Result: anything | nil -- part of return value constructed 
                    before error occurred, if given by application
        
        to_i -- Mac OS error number
        
        to_s -- formatted description of error</code></pre>


<h4><code>AE::MacOSError</code></h4>

<p>The <code>AE::MacOSError</code> exception is raised by the low-level <code>AE</code> extension and represents an error raised by the Apple Event Manager. The <code>AEM</code> API usually traps these low-level errors and throws more descriptive errors in their place (e.g. <code>AEM::EventError</code>).</p>

<pre><code>MacOSError &lt; StandardError

    Methods:
        number
            Result: integer -- the Mac OS error number
        
        description
            Result: string -- short generic error description</code></pre>

</div>

<!-- bottom navigation -->

<div class="footer">
<a href="05_targetingapplications.html">Previous</a> &bull;
<a href="index.html">Up</a> &bull;
<a href="07_findapp.html">Next</a>
</div>

</body>
</html>